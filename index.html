<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Happy Birthday Asia</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Dancing+Script:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&display=swap" rel="stylesheet">
  <style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #06060e;
  --neon-pink: #ff2d95;
  --neon-purple: #b44dff;
  --neon-blue: #00d4ff;
  --neon-gold: #ffb800;
  --neon-green: #00ff88;
  --neon-cyan: #00fff7;
  --text: #f0ede8;
  --text-dim: rgba(255,255,255,0.3);
}

html { scroll-behavior: smooth; }

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

canvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* ══════════════════════════════════
   START OVERLAY
   ══════════════════════════════════ */
.start-overlay {
  position: fixed;
  inset: 0;
  z-index: 100;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.8s ease, transform 0.8s ease;
}

.start-overlay.dissolve {
  opacity: 0;
  transform: scale(1.1);
  pointer-events: none;
}

#particleCanvas {
  position: absolute;
  inset: 0;
  z-index: 0;
}

.start-content {
  position: relative;
  z-index: 2;
  text-align: center;
}

.halo {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 300px;
  height: 300px;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  background: radial-gradient(circle, rgba(180,77,255,0.15) 0%, transparent 70%);
  animation: haloPulse 3s ease-in-out infinite;
  pointer-events: none;
}

@keyframes haloPulse {
  0%, 100% { transform: translate(-50%,-50%) scale(1); opacity: 0.6; }
  50% { transform: translate(-50%,-50%) scale(1.3); opacity: 1; }
}

.start-sub {
  font-size: 0.8rem;
  letter-spacing: 5px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 0.5rem;
  opacity: 0;
  animation: fadeUp 0.8s ease 0.3s forwards;
}

.start-name {
  font-family: 'Dancing Script', cursive;
  font-size: clamp(4rem, 14vw, 8rem);
  font-weight: 700;
  color: #fff;
  text-shadow:
    0 0 10px var(--neon-purple),
    0 0 30px var(--neon-purple),
    0 0 60px var(--neon-pink),
    0 0 100px var(--neon-pink);
  animation: neonPulse 2.5s ease-in-out infinite, fadeUp 1s ease 0.6s forwards;
  opacity: 0;
  margin-bottom: 2rem;
}

@keyframes neonPulse {
  0%, 100% {
    text-shadow:
      0 0 10px var(--neon-purple),
      0 0 30px var(--neon-purple),
      0 0 60px var(--neon-pink),
      0 0 100px var(--neon-pink);
  }
  50% {
    text-shadow:
      0 0 5px var(--neon-purple),
      0 0 15px var(--neon-purple),
      0 0 30px var(--neon-pink),
      0 0 50px var(--neon-pink);
  }
}

.start-btn {
  padding: 16px 44px;
  background: transparent;
  border: 2px solid var(--neon-purple);
  border-radius: 50px;
  color: #fff;
  font-family: inherit;
  font-size: 0.9rem;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  position: relative;
  opacity: 0;
  animation: fadeUp 0.8s ease 1s forwards;
  transition: all 0.3s;
  box-shadow:
    0 0 15px rgba(180,77,255,0.3),
    inset 0 0 15px rgba(180,77,255,0.1);
}

.start-btn:hover {
  background: rgba(180,77,255,0.15);
  box-shadow:
    0 0 30px rgba(180,77,255,0.5),
    0 0 60px rgba(180,77,255,0.2),
    inset 0 0 20px rgba(180,77,255,0.15);
  transform: scale(1.05);
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ══════════════════════════════════
   PAGE — CAKE
   ══════════════════════════════════ */
.page { position: relative; z-index: 1; }

.page-cake {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

/* Balloons */
#balloonContainer {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  overflow: hidden;
}

.balloon {
  position: absolute;
  bottom: -160px;
  opacity: 0;
}

.balloon-body {
  width: 44px;
  height: 56px;
  border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
  border: 2px solid currentColor;
  background: transparent;
  position: relative;
  box-shadow:
    0 0 8px currentColor,
    inset 0 0 8px rgba(255,255,255,0.05);
}

.balloon-body::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 50%;
  transform: translateX(-50%);
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 7px solid currentColor;
  filter: drop-shadow(0 0 4px currentColor);
}

.balloon-string {
  width: 1px;
  height: 40px;
  background: linear-gradient(180deg, currentColor, transparent);
  margin: 0 auto;
  opacity: 0.4;
}

@keyframes floatUp {
  0% { bottom: -160px; opacity: 0; transform: translateX(0) rotate(0deg); }
  8% { opacity: 0.9; }
  25% { transform: translateX(25px) rotate(4deg); }
  50% { transform: translateX(-20px) rotate(-3deg); }
  75% { transform: translateX(15px) rotate(2deg); }
  90% { opacity: 0.9; }
  100% { bottom: 110vh; opacity: 0; transform: translateX(-10px) rotate(-1deg); }
}

/* Title */
.hb-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(2rem, 6vw, 4rem);
  font-weight: 900;
  color: #fff;
  text-shadow:
    0 0 10px var(--neon-gold),
    0 0 30px var(--neon-gold),
    0 0 60px rgba(255,184,0,0.4);
  opacity: 0;
  transform: translateY(-25px);
  transition: opacity 1s ease, transform 1s ease;
  z-index: 5;
  position: relative;
  letter-spacing: 2px;
}

.hb-title.visible { opacity: 1; transform: translateY(0); }

.hb-name {
  font-family: 'Dancing Script', cursive;
  font-size: clamp(3rem, 10vw, 5.5rem);
  font-weight: 700;
  color: #fff;
  text-shadow:
    0 0 10px var(--neon-pink),
    0 0 30px var(--neon-pink),
    0 0 60px var(--neon-purple),
    0 0 90px var(--neon-purple);
  opacity: 0;
  transform: translateY(-20px);
  transition: opacity 1s ease 0.3s, transform 1s ease 0.3s;
  z-index: 5;
  position: relative;
  margin-bottom: 1.5rem;
  animation: none;
}

.hb-name.visible {
  opacity: 1;
  transform: translateY(0);
  animation: neonCycle 6s ease-in-out infinite;
}

@keyframes neonCycle {
  0%, 100% {
    text-shadow: 0 0 10px var(--neon-pink), 0 0 30px var(--neon-pink), 0 0 60px var(--neon-purple), 0 0 90px var(--neon-purple);
  }
  25% {
    text-shadow: 0 0 10px var(--neon-blue), 0 0 30px var(--neon-blue), 0 0 60px var(--neon-cyan), 0 0 90px var(--neon-cyan);
  }
  50% {
    text-shadow: 0 0 10px var(--neon-gold), 0 0 30px var(--neon-gold), 0 0 60px var(--neon-pink), 0 0 90px var(--neon-pink);
  }
  75% {
    text-shadow: 0 0 10px var(--neon-purple), 0 0 30px var(--neon-purple), 0 0 60px var(--neon-blue), 0 0 90px var(--neon-blue);
  }
}

/* ══════════════════════════════════
   NEON CAKE
   ══════════════════════════════════ */
.cake-wrapper {
  position: relative;
  z-index: 5;
  margin-bottom: 2.5rem;
}

.cake {
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Plate */
.plate {
  width: 240px;
  height: 14px;
  border: 2px solid rgba(255,255,255,0.25);
  border-radius: 50%;
  background: transparent;
  box-shadow:
    0 0 10px rgba(255,255,255,0.15),
    0 0 30px rgba(255,255,255,0.05),
    inset 0 0 10px rgba(255,255,255,0.05);
  opacity: 0;
  transform: scale(0.5);
  transition: opacity 0.6s ease, transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.plate.visible { opacity: 1; transform: scale(1); }

/* Layers — neon outlines */
.layer {
  border: 2px solid transparent;
  background: transparent;
  border-radius: 10px 10px 6px 6px;
  opacity: 0;
  transform: translateY(40px) scale(0.7);
  transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
}

.layer.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
}

.layer.flash {
  filter: brightness(2);
  transition: filter 0.15s ease;
}

.layer-1 {
  width: 200px;
  height: 55px;
  border-color: var(--neon-pink);
  margin-top: -8px;
  box-shadow:
    0 0 10px var(--neon-pink),
    0 0 25px rgba(255,45,149,0.3),
    inset 0 0 10px rgba(255,45,149,0.1);
}

.layer-2 {
  width: 150px;
  height: 48px;
  border-color: var(--neon-purple);
  margin-top: -4px;
  box-shadow:
    0 0 10px var(--neon-purple),
    0 0 25px rgba(180,77,255,0.3),
    inset 0 0 10px rgba(180,77,255,0.1);
}

.layer-3 {
  width: 105px;
  height: 40px;
  border-color: var(--neon-gold);
  margin-top: -4px;
  box-shadow:
    0 0 10px var(--neon-gold),
    0 0 25px rgba(255,184,0,0.3),
    inset 0 0 10px rgba(255,184,0,0.1);
}

/* Neon drips */
.neon-drip {
  position: absolute;
  bottom: -2px;
  width: 3px;
  border-radius: 0 0 3px 3px;
  opacity: 0;
  transform: scaleY(0);
  transform-origin: top;
  transition: opacity 0.4s ease, transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.neon-drip.visible { opacity: 1; transform: scaleY(1); }

/* Layer 3 drips (gold) */
.nd-1 { left: 18%; height: 12px; background: var(--neon-gold); box-shadow: 0 0 6px var(--neon-gold); transition-delay: 0.1s; }
.nd-2 { right: 22%; height: 16px; background: var(--neon-gold); box-shadow: 0 0 6px var(--neon-gold); transition-delay: 0.3s; }

/* Layer 2 drips (purple) */
.nd-3 { left: 15%; height: 14px; background: var(--neon-purple); box-shadow: 0 0 6px var(--neon-purple); transition-delay: 0.1s; }
.nd-4 { left: 50%; height: 18px; background: var(--neon-purple); box-shadow: 0 0 6px var(--neon-purple); transition-delay: 0.25s; }
.nd-5 { right: 18%; height: 12px; background: var(--neon-purple); box-shadow: 0 0 6px var(--neon-purple); transition-delay: 0.4s; }

/* Layer 1 drips (pink) */
.nd-6 { left: 10%; height: 16px; background: var(--neon-pink); box-shadow: 0 0 6px var(--neon-pink); transition-delay: 0.1s; }
.nd-7 { left: 35%; height: 22px; background: var(--neon-pink); box-shadow: 0 0 6px var(--neon-pink); transition-delay: 0.2s; }
.nd-8 { left: 60%; height: 14px; background: var(--neon-pink); box-shadow: 0 0 6px var(--neon-pink); transition-delay: 0.35s; }
.nd-9 { right: 10%; height: 18px; background: var(--neon-pink); box-shadow: 0 0 6px var(--neon-pink); transition-delay: 0.45s; }

/* Candles */
.candles {
  display: flex;
  gap: 16px;
  margin-bottom: -4px;
  position: relative;
  z-index: 3;
}

.candle {
  display: flex;
  flex-direction: column;
  align-items: center;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.candle.visible { opacity: 1; transform: translateY(0); }

.wick {
  width: 2px;
  height: 8px;
  background: rgba(255,255,255,0.3);
  border-radius: 1px;
}

.c1 .wick { box-shadow: 0 0 4px var(--neon-pink); }
.c2 .wick { box-shadow: 0 0 4px var(--neon-blue); }
.c3 .wick { box-shadow: 0 0 4px var(--neon-green); }

/* Candle body */
.candle::after {
  content: '';
  width: 8px;
  height: 26px;
  border-radius: 3px 3px 1px 1px;
  border: 1.5px solid currentColor;
  background: transparent;
}

.c1 { color: var(--neon-pink); }
.c1::after { box-shadow: 0 0 8px var(--neon-pink), inset 0 0 4px rgba(255,45,149,0.1); }

.c2 { color: var(--neon-blue); }
.c2::after { box-shadow: 0 0 8px var(--neon-blue), inset 0 0 4px rgba(0,212,255,0.1); }

.c3 { color: var(--neon-green); }
.c3::after { box-shadow: 0 0 8px var(--neon-green), inset 0 0 4px rgba(0,255,136,0.1); }

/* Flame */
.flame {
  width: 12px;
  height: 18px;
  position: relative;
  margin-bottom: -2px;
  opacity: 0;
  transform: scale(0);
  transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.flame.lit {
  opacity: 1;
  transform: scale(1);
  animation: flicker 0.3s ease-in-out infinite alternate;
}

.flame-core {
  width: 100%;
  height: 100%;
  border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
  background: radial-gradient(ellipse at 50% 80%, #fff 0%, #fbbf24 30%, #f97316 60%, transparent 100%);
  box-shadow:
    0 0 8px 3px rgba(251,191,36,0.6),
    0 0 20px 6px rgba(251,191,36,0.3),
    0 0 40px 10px rgba(249,115,22,0.15);
}

@keyframes flicker {
  0% { transform: scale(1) rotate(-3deg); }
  100% { transform: scale(0.88, 1.12) rotate(3deg); }
}

/* Next button */
.next-btn {
  position: relative;
  z-index: 10;
  padding: 16px 40px;
  background: transparent;
  border: 2px solid var(--neon-purple);
  border-radius: 50px;
  color: #fff;
  font-family: inherit;
  font-size: 0.85rem;
  font-weight: 600;
  letter-spacing: 2px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  opacity: 0;
  transform: translateY(25px);
  transition: opacity 1.5s ease, transform 1.5s ease, box-shadow 0.3s ease, background 0.3s ease;
  pointer-events: none;
  box-shadow:
    0 0 15px rgba(180,77,255,0.3),
    inset 0 0 15px rgba(180,77,255,0.05);
}

.next-btn.visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  animation: btnGlow 2s ease-in-out infinite;
}

.next-btn:hover {
  background: rgba(180,77,255,0.15);
  box-shadow:
    0 0 30px rgba(180,77,255,0.5),
    0 0 60px rgba(180,77,255,0.2),
    inset 0 0 20px rgba(180,77,255,0.1);
}

@keyframes btnGlow {
  0%, 100% { box-shadow: 0 0 15px rgba(180,77,255,0.3), inset 0 0 15px rgba(180,77,255,0.05); }
  50% { box-shadow: 0 0 25px rgba(180,77,255,0.5), 0 0 50px rgba(180,77,255,0.15), inset 0 0 20px rgba(180,77,255,0.08); }
}

/* ══════════════════════════════════
   PAGE — MEMORIES
   ══════════════════════════════════ */
.page-memories {
  min-height: 100vh;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: 1rem 1rem;
  overflow: hidden;
}

.page-memories.active { display: flex; animation: pageFadeIn 1s ease; }

@keyframes pageFadeIn { from { opacity: 0; } to { opacity: 1; } }

#starsCanvas2 { position: absolute; }

.mem-header {
  text-align: center;
  margin-bottom: 0.8rem;
  position: relative;
  z-index: 3;
}

.mem-label {
  font-size: 0.7rem;
  letter-spacing: 5px;
  text-transform: uppercase;
  color: var(--neon-purple);
  text-shadow: 0 0 10px rgba(180,77,255,0.4);
  margin-bottom: 0.5rem;
}

.mem-line {
  width: 40px;
  height: 2px;
  background: linear-gradient(90deg, var(--neon-purple), var(--neon-pink));
  margin: 0 auto;
  border-radius: 1px;
  box-shadow: 0 0 8px rgba(180,77,255,0.4);
}

/* Slideshow */
.slideshow {
  position: relative;
  z-index: 3;
  width: min(1100px, 95vw);
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.06);
  background: #000;
  box-shadow:
    0 0 40px rgba(180,77,255,0.12),
    0 0 80px rgba(0,0,0,0.8),
    0 30px 80px rgba(0,0,0,0.6);
}

.slide-viewport {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 10;
  overflow: hidden;
  background: #000;
}

.slide-img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 1.2s ease;
}

.slide-img.active {
  opacity: 1;
  animation: kenBurns 8s ease-in-out both;
}

@keyframes kenBurns {
  0% { transform: scale(1.02); }
  100% { transform: scale(1.1) translate(-1.2%, -0.8%); }
}

.slide-vignette {
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
  pointer-events: none;
  z-index: 2;
}

.slide-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(12px);
  color: rgba(255,255,255,0.5);
  font-size: 1.8rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
  opacity: 0;
}

.slideshow:hover .slide-btn { opacity: 1; }

.slide-btn:hover { background: rgba(180,77,255,0.25); color: #fff; border-color: var(--neon-purple); box-shadow: 0 0 16px rgba(180,77,255,0.4); }

.slide-prev { left: 16px; }
.slide-next { right: 16px; }

.slide-counter {
  position: absolute;
  top: 16px;
  right: 20px;
  z-index: 10;
  font-size: 0.75rem;
  letter-spacing: 3px;
  color: rgba(255,255,255,0.3);
  font-weight: 500;
  opacity: 0;
  transition: opacity 0.3s;
}

.slideshow:hover .slide-counter { opacity: 1; }

.slide-dots {
  position: absolute;
  bottom: 14px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  display: flex;
  gap: 8px;
}

.slide-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  border: none;
  background: rgba(255,255,255,0.2);
  cursor: pointer;
  transition: all 0.3s;
  padding: 0;
}

.slide-dot.active {
  background: var(--neon-purple);
  box-shadow: 0 0 8px rgba(180,77,255,0.5);
  transform: scale(1.3);
}

/* Message */
.msg-section {
  text-align: center;
  margin-top: 1.2rem;
  position: relative;
  z-index: 3;
}

.msg-text {
  font-family: 'Playfair Display', serif;
  font-style: italic;
  font-size: clamp(0.95rem, 2.5vw, 1.2rem);
  color: rgba(255,255,255,0.5);
  line-height: 1.8;
  max-width: 480px;
  margin: 0 auto 0.8rem;
  text-shadow: 0 0 20px rgba(180,77,255,0.15);
}

.msg-sign {
  font-size: 0.75rem;
  color: var(--neon-pink);
  letter-spacing: 3px;
  text-shadow: 0 0 10px rgba(255,45,149,0.3);
}

/* Again button */
.again-btn {
  margin-top: 2rem;
  padding: 12px 32px;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 50px;
  background: transparent;
  color: var(--text-dim);
  font-family: inherit;
  font-size: 0.75rem;
  font-weight: 500;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  position: relative;
  z-index: 3;
  transition: all 0.3s;
}

.again-btn:hover {
  border-color: var(--neon-purple);
  color: var(--neon-purple);
  box-shadow: 0 0 20px rgba(180,77,255,0.15);
}

.music-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 100;
  padding: 10px 20px;
  border: 1px solid rgba(180,77,255,0.4);
  border-radius: 50px;
  background: rgba(6,6,14,0.8);
  backdrop-filter: blur(10px);
  color: var(--neon-purple);
  font-family: inherit;
  font-size: 0.75rem;
  font-weight: 500;
  letter-spacing: 2px;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 0 15px rgba(180,77,255,0.15);
  animation: musicPulse 2s ease-in-out infinite;
}
.music-btn:hover {
  background: rgba(180,77,255,0.2);
  box-shadow: 0 0 25px rgba(180,77,255,0.3);
}
@keyframes musicPulse {
  0%, 100% { box-shadow: 0 0 15px rgba(180,77,255,0.15); }
  50% { box-shadow: 0 0 25px rgba(180,77,255,0.4); }
}


/* ══════════════════════════════════
   PAGE — 3D GALLERY
   ══════════════════════════════════ */
.page-gallery {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  z-index: 50;
}

.page-gallery.active { display: flex; animation: pageFadeIn 1.2s ease; }

.gallery-3d {
  perspective: 800px;
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  z-index: 2;
}

.gallery-scene {
  width: 0;
  height: 0;
  position: relative;
  transform-style: preserve-3d;
}

.gallery-card {
  position: absolute;
  width: 140px;
  height: 200px;
  cursor: pointer;
  border-radius: 10px;
  overflow: hidden;
  border: 1.5px solid rgba(180,77,255,0.35);
  box-shadow:
    0 0 20px rgba(180,77,255,0.2),
    0 0 50px rgba(255,45,149,0.1);
  transform-style: preserve-3d;
  will-change: transform;
}

.gallery-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  pointer-events: none;
}

/* The flying card clone that animates to/from user */
.fly-card {
  position: fixed;
  border-radius: 10px;
  overflow: hidden;
  border: 1.5px solid rgba(180,77,255,0.4);
  box-shadow:
    0 0 30px rgba(180,77,255,0.3),
    0 0 60px rgba(255,45,149,0.15);
  z-index: 200;
  pointer-events: none;
  will-change: transform, left, top, width, height;
  transition: left 0.6s cubic-bezier(0.25,1,0.5,1),
              top 0.6s cubic-bezier(0.25,1,0.5,1),
              width 0.6s cubic-bezier(0.25,1,0.5,1),
              height 0.6s cubic-bezier(0.25,1,0.5,1),
              border-radius 0.6s ease,
              opacity 0.3s ease;
}

.fly-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.fly-card.landed {
  pointer-events: auto;
  cursor: pointer;
  border-radius: 6px;
  box-shadow:
    0 0 50px rgba(180,77,255,0.3),
    0 0 100px rgba(255,45,149,0.15),
    0 30px 80px rgba(0,0,0,0.7);
}

.fly-card.returning {
  transition: left 0.5s cubic-bezier(0.5,0,0.75,0),
              top 0.5s cubic-bezier(0.5,0,0.75,0),
              width 0.5s cubic-bezier(0.5,0,0.75,0),
              height 0.5s cubic-bezier(0.5,0,0.75,0),
              border-radius 0.5s ease,
              opacity 0.4s ease 0.2s;
}

.fly-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0);
  z-index: 190;
  transition: background 0.5s ease;
  pointer-events: none;
}

.fly-backdrop.active {
  background: rgba(0,0,0,0.85);
  pointer-events: auto;
}

.gallery-hint {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  font-size: 0.7rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: rgba(255,255,255,0.25);
  text-align: center;
  pointer-events: none;
  animation: hintFade 5s ease 3s forwards;
}

@keyframes hintFade {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

@media (max-width: 600px) {
  .gallery-card { width: 110px; height: 155px; }
}

.gallery-back {
  position: fixed;
  top: 24px;
  left: 24px;
  z-index: 20;
  padding: 10px 20px;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 50px;
  background: rgba(6,6,14,0.6);
  backdrop-filter: blur(10px);
  color: rgba(255,255,255,0.4);
  font-family: inherit;
  font-size: 0.7rem;
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
}

.gallery-back:hover {
  border-color: var(--neon-purple);
  color: var(--neon-purple);
  box-shadow: 0 0 15px rgba(180,77,255,0.2);
}

/* (photo overlay removed — using fly-card instead) */

@media (max-width: 600px) {
  .gallery-card {
    width: 120px;
    height: 170px;
  }
}

/* Scrollbar */
::-webkit-scrollbar { width: 3px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--neon-purple); border-radius: 2px; }
::selection { background: rgba(180,77,255,0.3); color: #fff; }
  </style>
</head>
<body>

  <!-- ═══ START OVERLAY ═══ -->
  <div class="start-overlay" id="startOverlay">
    <canvas id="particleCanvas"></canvas>
    <div class="start-content">
      <div class="halo"></div>
      <p class="start-sub">a little something for</p>
      <h1 class="start-name">Asia</h1>
      <button class="start-btn" id="startBtn">Tap to Celebrate</button>
    </div>
  </div>

  <!-- ═══ PAGE 1: CAKE ═══ -->
  <section class="page page-cake" id="pageCake">
    <canvas id="starsCanvas"></canvas>
    <div id="balloonContainer"></div>

    <h1 class="hb-title" id="hbTitle">Happy Birthday</h1>
    <p class="hb-name" id="hbName">Asia</p>

    <div class="cake-wrapper" id="cakeWrapper">
      <div class="cake">
        <div class="candles" id="candles">
          <div class="candle c1"><div class="wick"></div><div class="flame" id="flame1"><div class="flame-core"></div></div></div>
          <div class="candle c2"><div class="wick"></div><div class="flame" id="flame2"><div class="flame-core"></div></div></div>
          <div class="candle c3"><div class="wick"></div><div class="flame" id="flame3"><div class="flame-core"></div></div></div>
        </div>
        <div class="layer layer-3" id="layer3">
          <div class="drip neon-drip nd-1"></div>
          <div class="drip neon-drip nd-2"></div>
        </div>
        <div class="layer layer-2" id="layer2">
          <div class="drip neon-drip nd-3"></div>
          <div class="drip neon-drip nd-4"></div>
          <div class="drip neon-drip nd-5"></div>
        </div>
        <div class="layer layer-1" id="layer1">
          <div class="drip neon-drip nd-6"></div>
          <div class="drip neon-drip nd-7"></div>
          <div class="drip neon-drip nd-8"></div>
          <div class="drip neon-drip nd-9"></div>
        </div>
        <div class="plate" id="plate"></div>
      </div>
    </div>

    <button class="next-btn" id="nextBtn">
      <span>See What I Made For You</span>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </button>
  </section>

  <!-- ═══ PAGE 2: MEMORIES ═══ -->
  <section class="page page-memories" id="pageMemories">
    <canvas id="starsCanvas2"></canvas>
    <canvas id="particleCanvas2" style="position:absolute;inset:0;z-index:0;pointer-events:none;"></canvas>
    <div class="mem-header" id="memHeader">
      <p class="mem-label">your memories</p>
      <div class="mem-line"></div>
    </div>

    <div class="slideshow" id="slideshow">
      <div class="slide-viewport" id="slideViewport"></div>
      <div class="slide-vignette"></div>
      <button class="slide-btn slide-prev" id="slidePrev">&#8249;</button>
      <button class="slide-btn slide-next" id="slideNext">&#8250;</button>
      <div class="slide-counter" id="slideCounter">1 / 7</div>
      <div class="slide-dots" id="slideDots"></div>
    </div>

    <div class="msg-section" id="msgSection">
      <p class="msg-text">You mean the world to me.<br>Not just today, but every single day.<br>Thank you for being you.</p>
      <p class="msg-sign">with all my love</p>
    </div>

    <button class="again-btn" id="againBtn">Enter the Gallery</button>
    <audio id="birthdayAudio" src="birthday-piano.mp3" loop></audio>
    <audio id="memoriesAudio" src="memories.mp3" loop></audio>
    <button class="music-btn" id="musicBtn" onclick="document.getElementById('memoriesAudio').play();this.style.display='none';">&#9654; Play Music</button>
  </section>

  <!-- ═══ PAGE 3: 3D GALLERY ═══ -->
  <section class="page page-gallery" id="pageGallery">
    <canvas id="particleCanvas3" style="position:absolute;inset:0;z-index:0;pointer-events:none;"></canvas>
    <button class="gallery-back" id="galleryBack">&#8249; Back</button>

    <div class="gallery-3d" id="gallery3d">
      <div class="gallery-scene" id="galleryScene">
        <div class="gallery-card"><img src="photos/631238345_1413865627105763_1098670414832295385_n.jpg" alt="Memory 1"></div>
        <div class="gallery-card"><img src="photos/632605426_2743496372651771_5087056815613210159_n.jpg" alt="Memory 2"></div>
        <div class="gallery-card"><img src="photos/634555843_1977783543137215_8727257106951131452_n.jpg" alt="Memory 3"></div>
        <div class="gallery-card"><img src="photos/634716292_1987974791811645_1033515507445936490_n.jpg" alt="Memory 4"></div>
        <div class="gallery-card"><img src="photos/634846621_1489609379369334_1468262594684237586_n.jpg" alt="Memory 5"></div>
        <div class="gallery-card"><img src="photos/636680558_1438960177824267_4786415350908794643_n.jpg" alt="Memory 6"></div>
        <div class="gallery-card"><img src="photos/637013449_801733399623594_2609924921644433182_n.jpg" alt="Memory 7"></div>
      </div>
    </div>

    <p class="gallery-hint" id="galleryHint">move your phone around &middot; tap a photo</p>
    <div class="fly-backdrop" id="flyBackdrop"></div>
  </section>

  <script>
// ══════════════════════════════════
//  PHOTOS
// ══════════════════════════════════
window.PHOTOS = [
  "photos/631238345_1413865627105763_1098670414832295385_n.jpg",
  "photos/632605426_2743496372651771_5087056815613210159_n.jpg",
  "photos/634555843_1977783543137215_8727257106951131452_n.jpg",
  "photos/634716292_1987974791811645_1033515507445936490_n.jpg",
  "photos/634846621_1489609379369334_1468262594684237586_n.jpg",
  "photos/636680558_1438960177824267_4786415350908794643_n.jpg",
  "photos/637013449_801733399623594_2609924921644433182_n.jpg"
];

// ══════════════════════════════════
//  STARS CANVAS
// ══════════════════════════════════
const starColors = ['#b44dff', '#ff2d95', '#00d4ff', '#ffb800', '#00ff88', '#e879f9', '#00fff7'];

function initStars(id, colored) {
  const c = document.getElementById(id);
  if (!c) return;
  const ctx = c.getContext('2d');
  let stars = [];

  function resize() {
    c.width = window.innerWidth;
    c.height = window.innerHeight;
    stars = [];
    const count = colored
      ? Math.floor((c.width * c.height) / 3500)
      : Math.floor((c.width * c.height) / 4500);
    for (let i = 0; i < count; i++) {
      stars.push({
        x: Math.random() * c.width,
        y: Math.random() * c.height,
        r: colored ? Math.random() * 1.8 + 0.3 : Math.random() * 1.3 + 0.2,
        a: Math.random() * 0.5 + 0.15,
        s: Math.random() * 0.004 + 0.001,
        p: Math.random() * Math.PI * 2,
        color: colored ? starColors[Math.floor(Math.random() * starColors.length)] : null
      });
    }
  }

  function draw(t) {
    ctx.clearRect(0, 0, c.width, c.height);
    for (const s of stars) {
      const tw = Math.sin(t * s.s + s.p) * 0.35 + 0.65;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      if (s.color) {
        ctx.fillStyle = s.color;
        ctx.globalAlpha = s.a * tw;
      } else {
        ctx.fillStyle = `rgba(255,255,255,${s.a * tw})`;
        ctx.shadowBlur = 0;
      }
      ctx.fill();
    }
    ctx.shadowBlur = 0;
    ctx.globalAlpha = 1;
    requestAnimationFrame(draw);
  }

  resize();
  requestAnimationFrame(draw);
  window.addEventListener('resize', resize);
}

// ══════════════════════════════════
//  PARTICLE FIELD
// ══════════════════════════════════
const particleColors = ['#b44dff', '#ff2d95', '#00d4ff', '#ffb800', '#00ff88'];

function initParticleField(canvasId, opts) {
  const c = document.getElementById(canvasId);
  if (!c) return;
  const ctx = c.getContext('2d');
  let particles = [];
  const count = (opts && opts.count) || 80;
  const checkStop = opts && opts.stopWhen;
  const lite = opts && opts.lite;

  function resize() {
    c.width = window.innerWidth;
    c.height = window.innerHeight;
    particles = [];
    for (let i = 0; i < count; i++) {
      particles.push({
        x: Math.random() * c.width,
        y: Math.random() * c.height,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5,
        r: Math.random() * 2 + 0.5,
        color: particleColors[Math.floor(Math.random() * particleColors.length)],
        a: Math.random() * 0.5 + 0.2,
        pulse: Math.random() * Math.PI * 2
      });
    }
  }

  function draw(t) {
    if (checkStop && checkStop()) return;
    ctx.clearRect(0, 0, c.width, c.height);
    for (const p of particles) {
      p.x += p.vx;
      p.y += p.vy;
      if (p.x < 0) p.x = c.width;
      if (p.x > c.width) p.x = 0;
      if (p.y < 0) p.y = c.height;
      if (p.y > c.height) p.y = 0;

      const glow = Math.sin(t * 0.002 + p.pulse) * 0.2 + 0.8;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = p.color;
      ctx.globalAlpha = p.a * glow;
      if (!lite) {
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 12;
      }
      ctx.fill();
    }
    ctx.shadowBlur = 0;
    ctx.globalAlpha = 1;
    requestAnimationFrame(draw);
  }

  resize();
  requestAnimationFrame(draw);
  window.addEventListener('resize', resize);
}

// Start screen particles (stop when overlay dissolves)
initParticleField('particleCanvas', {
  count: 80,
  stopWhen: () => {
    const el = document.getElementById('startOverlay');
    return !el || el.classList.contains('dissolve');
  }
});

// ══════════════════════════════════
//  BIRTHDAY PIANO MUSIC
// ══════════════════════════════════
const birthdayAudio = document.getElementById('birthdayAudio');

function initAudio() {}

function playHappyBirthday() {
  if (!birthdayAudio) return;
  birthdayAudio.volume = 0;
  birthdayAudio.play().catch(() => {});
  // Fade in
  let vol = 0;
  const fadeIn = setInterval(() => {
    vol += 0.05;
    if (vol >= 0.8) { vol = 0.8; clearInterval(fadeIn); }
    birthdayAudio.volume = vol;
  }, 60);
}

function fadeOutMusic() {
  if (!birthdayAudio) return;
  let vol = birthdayAudio.volume;
  const fadeOut = setInterval(() => {
    vol -= 0.02;
    if (vol <= 0) { vol = 0; birthdayAudio.pause(); clearInterval(fadeOut); }
    birthdayAudio.volume = vol;
  }, 60);
}

function crossfadeToMemories() {
  // Fade out birthday piano
  if (birthdayAudio) {
    let bVol = birthdayAudio.volume;
    const fadeOut = setInterval(() => {
      bVol -= 0.02;
      if (bVol <= 0) { bVol = 0; birthdayAudio.pause(); clearInterval(fadeOut); }
      birthdayAudio.volume = bVol;
    }, 60);
  }
  // Fade in Memories
  const audio = document.getElementById('memoriesAudio');
  if (!audio) return;
  audio.volume = 0;
  audio.play().catch(() => {});
  let vol = 0;
  const fadeIn = setInterval(() => {
    vol += 0.02;
    if (vol >= 1) { vol = 1; clearInterval(fadeIn); }
    audio.volume = vol;
  }, 60);
  const btn = document.getElementById('musicBtn');
  if (btn) btn.style.display = 'none';
}

// ══════════════════════════════════
//  NEON BALLOONS
// ══════════════════════════════════
const balloonContainer = document.getElementById('balloonContainer');
const neonColors = ['#ff2d95', '#b44dff', '#00d4ff', '#ffb800', '#00ff88', '#ff6b35', '#e879f9', '#00fff7'];

function launchBalloon() {
  const b = document.createElement('div');
  b.className = 'balloon';
  const color = neonColors[Math.floor(Math.random() * neonColors.length)];
  b.style.color = color;
  b.style.left = (Math.random() * 85 + 5) + '%';

  const size = Math.random() * 16 + 38;
  const body = document.createElement('div');
  body.className = 'balloon-body';
  body.style.width = size + 'px';
  body.style.height = (size * 1.28) + 'px';

  const string = document.createElement('div');
  string.className = 'balloon-string';

  b.appendChild(body);
  b.appendChild(string);
  balloonContainer.appendChild(b);

  const dur = Math.random() * 4000 + 5000;
  b.style.animation = `floatUp ${dur}ms ease-in-out forwards`;
  b.style.animationDelay = (Math.random() * 300) + 'ms';

  setTimeout(() => b.remove(), dur + 500);
}

function launchWave(count, interval) {
  for (let i = 0; i < count; i++) setTimeout(launchBalloon, i * interval);
}

// ══════════════════════════════════
//  CAKE BUILD SEQUENCE
// ══════════════════════════════════
const hbTitle = document.getElementById('hbTitle');
const hbName = document.getElementById('hbName');
const plate = document.getElementById('plate');
const layer1 = document.getElementById('layer1');
const layer2 = document.getElementById('layer2');
const layer3 = document.getElementById('layer3');
const candleEls = document.querySelectorAll('.candle');
const flame1 = document.getElementById('flame1');
const flame2 = document.getElementById('flame2');
const flame3 = document.getElementById('flame3');
const nextBtn = document.getElementById('nextBtn');

function flashLayer(el) {
  el.classList.add('flash');
  setTimeout(() => el.classList.remove('flash'), 200);
}

function runCakeSequence() {
  const seq = [
    [0, () => { hbTitle.classList.add('visible'); }],
    [500, () => { hbName.classList.add('visible'); }],
    [1400, () => { plate.classList.add('visible'); }],
    [2200, () => {
      layer1.classList.add('visible');
      setTimeout(() => flashLayer(layer1), 700);
      launchWave(3, 250);
    }],
    [3200, () => layer1.querySelectorAll('.neon-drip').forEach(d => d.classList.add('visible'))],
    [3600, () => {
      layer2.classList.add('visible');
      setTimeout(() => flashLayer(layer2), 700);
      launchWave(3, 250);
    }],
    [4500, () => layer2.querySelectorAll('.neon-drip').forEach(d => d.classList.add('visible'))],
    [4900, () => {
      layer3.classList.add('visible');
      setTimeout(() => flashLayer(layer3), 700);
      launchWave(4, 200);
    }],
    [5700, () => layer3.querySelectorAll('.neon-drip').forEach(d => d.classList.add('visible'))],
    [6200, () => { candleEls[0].classList.add('visible'); }],
    [6500, () => { candleEls[1].classList.add('visible'); }],
    [6800, () => { candleEls[2].classList.add('visible'); }],
    [7300, () => { flame1.classList.add('lit'); }],
    [7600, () => { flame2.classList.add('lit'); }],
    [7900, () => {
      flame3.classList.add('lit');
      launchWave(10, 150);
    }],
    [8500, () => { playHappyBirthday(); }],
    [11500, () => { nextBtn.classList.add('visible'); }],
  ];

  seq.forEach(([ms, fn]) => setTimeout(fn, ms));

  const iv = setInterval(() => {
    if (document.getElementById('pageCake').style.display === 'none') { clearInterval(iv); return; }
    launchBalloon();
  }, 1800);
}

// ══════════════════════════════════
//  START OVERLAY
// ══════════════════════════════════
document.getElementById('startBtn').addEventListener('click', () => {
  initAudio();
  const overlay = document.getElementById('startOverlay');
  overlay.classList.add('dissolve');
  setTimeout(() => {
    overlay.style.display = 'none';
    initStars('starsCanvas');
    runCakeSequence();
  }, 800);
});

// ══════════════════════════════════
//  PAGE TRANSITION — CAKE → MEMORIES
// ══════════════════════════════════
nextBtn.addEventListener('click', () => {
  crossfadeToMemories();
  const pageCake = document.getElementById('pageCake');
  const pageMem = document.getElementById('pageMemories');

  pageCake.style.transition = 'opacity 0.8s ease';
  pageCake.style.opacity = '0';

  setTimeout(() => {
    pageCake.style.display = 'none';
    pageMem.classList.add('active');
    initStars('starsCanvas2', true);
    initParticleField('particleCanvas2', { count: 50, lite: true });
    initSlideshow();
  }, 800);
});

// ══════════════════════════════════
//  CINEMATIC SLIDESHOW
// ══════════════════════════════════
let slideIndex = 0;
let slideTimer = null;
let slideImgs = [];

// Memories Music Player
function initMemoriesMusic() {
  const audio = document.getElementById('memoriesAudio');
  if (audio) audio.play().catch(() => {});
}

function initSlideshow() {
  const viewport = document.getElementById('slideViewport');
  const dotsEl = document.getElementById('slideDots');
  if (!viewport || !dotsEl) { console.error('Slideshow elements not found'); return; }
  viewport.innerHTML = '';
  initMemoriesMusic();
  dotsEl.innerHTML = '';
  slideImgs = [];

  if (!window.PHOTOS || PHOTOS.length === 0) { console.error('No photos!'); return; }

  PHOTOS.forEach((src, i) => {
    const img = document.createElement('img');
    img.className = 'slide-img';
    img.src = src;
    img.alt = 'Memory ' + (i + 1);
    viewport.appendChild(img);
    slideImgs.push(img);

    const dot = document.createElement('button');
    dot.className = 'slide-dot';
    dot.onclick = () => goSlide(i);
    dotsEl.appendChild(dot);
  });

  slideIndex = 0;
  showSlide(0);
  startAutoAdvance();

  document.getElementById('slidePrev').onclick = () => { goSlide((slideIndex - 1 + PHOTOS.length) % PHOTOS.length); resetAutoAdvance(); };
  document.getElementById('slideNext').onclick = () => { goSlide((slideIndex + 1) % PHOTOS.length); resetAutoAdvance(); };

  let tx = 0;
  const ss = document.getElementById('slideshow');
  ss.addEventListener('touchstart', e => { tx = e.touches[0].clientX; });
  ss.addEventListener('touchend', e => {
    const diff = tx - e.changedTouches[0].clientX;
    if (Math.abs(diff) > 50) {
      diff > 0 ? goSlide((slideIndex + 1) % PHOTOS.length) : goSlide((slideIndex - 1 + PHOTOS.length) % PHOTOS.length);
      resetAutoAdvance();
    }
  });

  document.addEventListener('keydown', e => {
    if (!document.getElementById('pageMemories').classList.contains('active')) return;
    if (e.key === 'ArrowLeft') { goSlide((slideIndex - 1 + PHOTOS.length) % PHOTOS.length); resetAutoAdvance(); }
    if (e.key === 'ArrowRight') { goSlide((slideIndex + 1) % PHOTOS.length); resetAutoAdvance(); }
  });
}

function showSlide(i) {
  slideImgs.forEach(img => img.classList.remove('active'));

  const target = slideImgs[i];
  if (target) {
    void target.offsetWidth;
    target.classList.add('active');
  }

  document.querySelectorAll('.slide-dot').forEach((d, idx) => d.classList.toggle('active', idx === i));
  document.getElementById('slideCounter').textContent = (i + 1) + ' / ' + PHOTOS.length;
}

function goSlide(i) {
  slideIndex = i;
  showSlide(i);
}

function startAutoAdvance() {
  slideTimer = setInterval(() => {
    slideIndex = (slideIndex + 1) % PHOTOS.length;
    showSlide(slideIndex);
  }, 5000);
}

function resetAutoAdvance() {
  clearInterval(slideTimer);
  startAutoAdvance();
}

// ══════════════════════════════════
//  ENTER THE GALLERY (replaces Experience Again)
// ══════════════════════════════════
document.getElementById('againBtn').addEventListener('click', () => {
  clearInterval(slideTimer);
  const pageMem = document.getElementById('pageMemories');
  const pageGal = document.getElementById('pageGallery');

  // Fade out memories audio
  const memAudio = document.getElementById('memoriesAudio');
  if (memAudio) {
    let vol = memAudio.volume;
    const fo = setInterval(() => {
      vol -= 0.03;
      if (vol <= 0) { vol = 0; memAudio.pause(); clearInterval(fo); }
      memAudio.volume = vol;
    }, 50);
  }

  pageMem.style.transition = 'opacity 0.8s ease';
  pageMem.style.opacity = '0';

  setTimeout(() => {
    pageMem.classList.remove('active');
    pageMem.style.opacity = '';
    pageMem.style.transition = '';
    pageGal.classList.add('active');
    initParticleField('particleCanvas3', { count: 50, lite: true });
    initGallery();
    startAmbientPiano();
  }, 800);
});

// ══════════════════════════════════
//  GALLERY BACK BUTTON
// ══════════════════════════════════
document.getElementById('galleryBack').addEventListener('click', () => {
  const pageGal = document.getElementById('pageGallery');
  const pageMem = document.getElementById('pageMemories');

  stopAmbientPiano();
  cancelAnimationFrame(galleryRAF);
  galleryRAF = null;
  gyroActive = false;
  if (gyroHandler) {
    window.removeEventListener('deviceorientation', gyroHandler);
    gyroHandler = null;
  }

  pageGal.style.transition = 'opacity 0.8s ease';
  pageGal.style.opacity = '0';

  setTimeout(() => {
    pageGal.classList.remove('active');
    pageGal.style.opacity = '';
    pageGal.style.transition = '';
    pageMem.classList.add('active');
    initParticleField('particleCanvas2', { count: 50, lite: true });
    initSlideshow();

    // Restart memories audio
    const memAudio = document.getElementById('memoriesAudio');
    if (memAudio) {
      memAudio.volume = 0;
      memAudio.play().catch(() => {});
      let v = 0;
      const fi = setInterval(() => {
        v += 0.03;
        if (v >= 1) { v = 1; clearInterval(fi); }
        memAudio.volume = v;
      }, 50);
    }
    const btn = document.getElementById('musicBtn');
    if (btn) btn.style.display = 'none';
  }, 800);
});

// ══════════════════════════════════
//  3D GALLERY — ORBITING PHOTOS + GYRO LOOK
// ══════════════════════════════════
let galYaw = 0;
let galPitch = 0;
let galVelX = 0;
let galVelY = 0;
let galDragging = false;
let galLastX = 0;
let galLastY = 0;
let galleryRAF = null;
let gyroActive = false;
let gyroHandler = null;

function initGallery() {
  const scene = document.getElementById('galleryScene');
  const container = document.getElementById('gallery3d');
  const backdrop = document.getElementById('flyBackdrop');
  const cards = document.querySelectorAll('.gallery-card');

  galYaw = 0;
  galPitch = 0;
  galVelX = 0;
  galVelY = 0;

  // Each card orbits freely — different speeds, heights, directions
  const radius = window.innerWidth < 600 ? 260 : 360;
  const cardData = [];
  cards.forEach((card, i) => {
    cardData.push({
      angle: (i / cards.length) * 360,
      speed: 0.12 + Math.random() * 0.15,         // varied orbit speeds
      yBase: (Math.random() - 0.5) * 80,          // random base height
      yAmp: 40 + Math.random() * 60,              // big vertical swing (40-100px)
      ySpeed: 0.6 + Math.random() * 0.8,          // vertical bob speed
      yPhase: Math.random() * Math.PI * 2,         // offset so they don't sync
      tiltAmp: 8 + Math.random() * 12,            // slight tilt as they fly
      tiltPhase: Math.random() * Math.PI * 2,
      el: card
    });
  });

  // ── TOUCH / MOUSE — drag to look around ──
  let dragStartX = 0, dragStartY = 0, dragMoved = false;

  function onStart(x, y) {
    galDragging = true;
    galLastX = x; galLastY = y;
    dragStartX = x; dragStartY = y;
    dragMoved = false;
    galVelX = 0; galVelY = 0;
  }

  function onMove(x, y) {
    if (!galDragging) return;
    const dx = x - galLastX;
    const dy = y - galLastY;
    if (Math.abs(x - dragStartX) > 6 || Math.abs(y - dragStartY) > 6) dragMoved = true;
    galYaw -= dx * 0.35;
    galPitch += dy * 0.25;
    galPitch = Math.max(-50, Math.min(50, galPitch));
    galVelX = -dx * 0.35;
    galVelY = dy * 0.25;
    galLastX = x; galLastY = y;
  }

  function onEnd() { galDragging = false; }

  container.addEventListener('mousedown', e => { e.preventDefault(); onStart(e.clientX, e.clientY); });
  window.addEventListener('mousemove', e => onMove(e.clientX, e.clientY));
  window.addEventListener('mouseup', onEnd);
  container.addEventListener('touchstart', e => onStart(e.touches[0].clientX, e.touches[0].clientY), { passive: true });
  container.addEventListener('touchmove', e => { e.preventDefault(); onMove(e.touches[0].clientX, e.touches[0].clientY); }, { passive: false });
  container.addEventListener('touchend', onEnd);

  // ── GYROSCOPE ──
  if (gyroHandler) { window.removeEventListener('deviceorientation', gyroHandler); gyroHandler = null; }
  gyroActive = false;
  let gyroBaseA = null, gyroBaseB = null, gyroReady = false;

  gyroHandler = function(e) {
    if (e.alpha === null || e.beta === null) return;
    if (!gyroReady) { gyroBaseA = e.alpha; gyroBaseB = e.beta; gyroReady = true; gyroActive = true; return; }
    let dA = e.alpha - gyroBaseA;
    if (dA > 180) dA -= 360;
    if (dA < -180) dA += 360;
    let dB = e.beta - gyroBaseB;
    if (!galDragging) {
      const tY = -dA * 1.5;
      const tP = Math.max(-50, Math.min(50, -dB * 1.0));
      galYaw += (tY - galYaw) * 0.1;
      galPitch += (tP - galPitch) * 0.1;
    }
  };

  if ('ontouchstart' in window) {
    if (typeof DeviceOrientationEvent !== 'undefined' &&
        typeof DeviceOrientationEvent.requestPermission === 'function') {
      DeviceOrientationEvent.requestPermission()
        .then(p => { if (p === 'granted') window.addEventListener('deviceorientation', gyroHandler); })
        .catch(() => {});
    } else {
      window.addEventListener('deviceorientation', gyroHandler);
    }
  }

  // ── CARD TAP — fly the card to user's face ──
  let flyCard = null;
  let flyOpen = false;
  let flySourceRect = null;

  function openCard(card) {
    if (dragMoved || flyOpen) return;
    flyOpen = true;

    // Get the card's screen position
    const rect = card.getBoundingClientRect();
    flySourceRect = { left: rect.left, top: rect.top, width: rect.width, height: rect.height };

    // Create a clone that flies
    flyCard = document.createElement('div');
    flyCard.className = 'fly-card';
    const img = document.createElement('img');
    img.src = card.querySelector('img').src;
    flyCard.appendChild(img);

    // Start at card's screen position
    flyCard.style.left = rect.left + 'px';
    flyCard.style.top = rect.top + 'px';
    flyCard.style.width = rect.width + 'px';
    flyCard.style.height = rect.height + 'px';
    document.body.appendChild(flyCard);

    // Show backdrop
    backdrop.classList.add('active');

    // Fly to center of screen
    requestAnimationFrame(() => {
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      // Target: centered, max 90vw or 85vh, keep aspect ratio
      const imgEl = card.querySelector('img');
      const natW = imgEl.naturalWidth || 400;
      const natH = imgEl.naturalHeight || 600;
      const maxW = vw * 0.88;
      const maxH = vh * 0.82;
      const scale = Math.min(maxW / natW, maxH / natH);
      const finalW = natW * scale;
      const finalH = natH * scale;
      const finalL = (vw - finalW) / 2;
      const finalT = (vh - finalH) / 2;

      flyCard.style.left = finalL + 'px';
      flyCard.style.top = finalT + 'px';
      flyCard.style.width = finalW + 'px';
      flyCard.style.height = finalH + 'px';
    });

    // Mark as landed after animation
    setTimeout(() => {
      if (flyCard) flyCard.classList.add('landed');
      // Tap the landed card or backdrop to dismiss
      if (flyCard) flyCard.addEventListener('click', closeCard);
    }, 650);
  }

  function closeCard() {
    if (!flyOpen || !flyCard) return;
    flyCard.classList.remove('landed');
    flyCard.classList.add('returning');
    backdrop.classList.remove('active');

    // Fly back to source position
    flyCard.style.left = flySourceRect.left + 'px';
    flyCard.style.top = flySourceRect.top + 'px';
    flyCard.style.width = flySourceRect.width + 'px';
    flyCard.style.height = flySourceRect.height + 'px';
    flyCard.style.opacity = '0';

    setTimeout(() => {
      if (flyCard) { flyCard.remove(); flyCard = null; }
      flyOpen = false;
    }, 550);
  }

  backdrop.addEventListener('click', closeCard);

  cards.forEach(card => {
    card.addEventListener('click', () => openCard(card));
  });

  // ── MAIN ANIMATION LOOP — orbit cards + apply look ──
  let time = 0;

  function animate() {
    if (!document.getElementById('pageGallery').classList.contains('active')) return;
    time++;

    // Momentum when not dragging and no gyro
    if (!galDragging && !gyroActive) {
      galYaw += galVelX;
      galPitch += galVelY;
      galPitch = Math.max(-50, Math.min(50, galPitch));
      galVelX *= 0.93;
      galVelY *= 0.93;
      if (Math.abs(galVelX) < 0.005) galVelX = 0;
      if (Math.abs(galVelY) < 0.005) galVelY = 0;
    }

    // Apply look direction to scene
    scene.style.transform = `rotateX(${galPitch}deg) rotateY(${galYaw}deg)`;

    // Orbit each card — flying around, going up and down freely
    for (const cd of cardData) {
      cd.angle += cd.speed;
      if (cd.angle >= 360) cd.angle -= 360;

      const rad = cd.angle * Math.PI / 180;
      const x = radius * Math.sin(rad);
      const z = radius * Math.cos(rad);

      // Big alive vertical movement
      const y = cd.yBase + Math.sin(time * 0.008 * cd.ySpeed + cd.yPhase) * cd.yAmp;

      // Slight tilt/wobble as they fly (feels organic)
      const tilt = Math.sin(time * 0.006 + cd.tiltPhase) * cd.tiltAmp;

      cd.el.style.transform =
        `translate3d(${x}px, ${-y}px, ${-z}px) rotateY(${cd.angle}deg) rotateZ(${tilt}deg)`;
    }

    galleryRAF = requestAnimationFrame(animate);
  }

  animate();
}

// ══════════════════════════════════
//  GENERATIVE AMBIENT PIANO
// ══════════════════════════════════
let pianoCtx = null;
let pianoGain = null;
let pianoTimer = null;
let pianoConvolver = null;

function createReverb(ctx) {
  const convolver = ctx.createConvolver();
  const rate = ctx.sampleRate;
  const length = rate * 3;
  const impulse = ctx.createBuffer(2, length, rate);
  for (let ch = 0; ch < 2; ch++) {
    const data = impulse.getChannelData(ch);
    for (let i = 0; i < length; i++) {
      data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 2.5);
    }
  }
  convolver.buffer = impulse;
  return convolver;
}

function startAmbientPiano() {
  pianoCtx = new (window.AudioContext || window.webkitAudioContext)();
  pianoGain = pianoCtx.createGain();
  pianoGain.gain.value = 0.25;

  pianoConvolver = createReverb(pianoCtx);
  const wetGain = pianoCtx.createGain();
  wetGain.gain.value = 0.6;
  const dryGain = pianoCtx.createGain();
  dryGain.gain.value = 0.4;

  pianoGain.connect(dryGain);
  dryGain.connect(pianoCtx.destination);
  pianoGain.connect(pianoConvolver);
  pianoConvolver.connect(wetGain);
  wetGain.connect(pianoCtx.destination);

  // Pentatonic notes across octaves (dreamy, no dissonance)
  const notes = [
    261.63, 293.66, 329.63, 392.00, 440.00,  // C4 D4 E4 G4 A4
    523.25, 587.33, 659.25, 783.99, 880.00,  // C5 D5 E5 G5 A5
    130.81, 146.83, 164.81, 196.00, 220.00   // C3 D3 E3 G3 A3
  ];

  let lastNote = -1;

  function playNote() {
    if (!pianoCtx || pianoCtx.state === 'closed') return;

    // Pick a note (avoid repeating the same one)
    let idx;
    do { idx = Math.floor(Math.random() * notes.length); } while (idx === lastNote);
    lastNote = idx;
    const freq = notes[idx];
    const t = pianoCtx.currentTime;

    // Main tone (sine — warm piano fundamental)
    const osc = pianoCtx.createOscillator();
    const g = pianoCtx.createGain();
    osc.type = 'sine';
    osc.frequency.value = freq;
    g.gain.setValueAtTime(0.3, t);
    g.gain.exponentialRampToValueAtTime(0.001, t + 3.5);
    osc.connect(g);
    g.connect(pianoGain);
    osc.start(t);
    osc.stop(t + 4);

    // Soft overtone (triangle, octave up)
    const osc2 = pianoCtx.createOscillator();
    const g2 = pianoCtx.createGain();
    osc2.type = 'triangle';
    osc2.frequency.value = freq * 2;
    g2.gain.setValueAtTime(0.06, t);
    g2.gain.exponentialRampToValueAtTime(0.001, t + 2.5);
    osc2.connect(g2);
    g2.connect(pianoGain);
    osc2.start(t);
    osc2.stop(t + 3);

    // Sometimes play a chord (30% chance)
    if (Math.random() < 0.3) {
      const chordNote = notes[(idx + 2) % notes.length];
      const osc3 = pianoCtx.createOscillator();
      const g3 = pianoCtx.createGain();
      osc3.type = 'sine';
      osc3.frequency.value = chordNote;
      g3.gain.setValueAtTime(0.15, t + 0.1);
      g3.gain.exponentialRampToValueAtTime(0.001, t + 3);
      osc3.connect(g3);
      g3.connect(pianoGain);
      osc3.start(t + 0.1);
      osc3.stop(t + 3.5);
    }

    // Schedule next note (1.2 - 2.8 seconds)
    const next = 1200 + Math.random() * 1600;
    pianoTimer = setTimeout(playNote, next);
  }

  playNote();
}

function stopAmbientPiano() {
  if (pianoTimer) { clearTimeout(pianoTimer); pianoTimer = null; }
  if (pianoCtx && pianoCtx.state !== 'closed') {
    if (pianoGain) {
      pianoGain.gain.linearRampToValueAtTime(0, pianoCtx.currentTime + 1.5);
    }
    setTimeout(() => {
      if (pianoCtx && pianoCtx.state !== 'closed') pianoCtx.close().catch(() => {});
      pianoCtx = null;
    }, 2000);
  }
}
  </script>
</body>
</html>
